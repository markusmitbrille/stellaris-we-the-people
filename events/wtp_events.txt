namespace = wtp
@unrest_threshold_low = 12
@unrest_threshold_high = 60
@rebellion_threshold = 240
country_event = {
	id = wtp.100
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_country_type = default
		is_regular_empire = yes
	}
	immediate = {
		log = "WTP::WTP.100(this = [This.GetName], from = [From.GetName], fromfrom = [FromFrom.GetName])"
		every_owned_planet = {
			if = {
				limit = {
					sector = {
						is_same_value = PREVPREV.capital_scope.sector
					}
				}
				wtp_effect_remove_unrest = yes
				set_variable = {
					which = wtp_var_unrest
					value = 0
				}
			}
			else = {
				planet_event = {
					id = wtp.1
				}
			}
		}
	}
}

country_event = {
	id = wtp.101
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NAND = {
			is_country_type = default
			is_regular_empire = yes
		}
	}
	immediate = {
		log = "WTP::WTP.101(this = [This.GetName], from = [From.GetName], fromfrom = [FromFrom.GetName])"
		every_owned_planet = {
			wtp_effect_remove_unrest = yes
			set_variable = {
				which = wtp_var_unrest
				value = 0
			}
		}
	}
}

planet_event = {
	id = wtp.102
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		log = "WTP::WTP.102(this = [This.GetName], from = [From.GetName], fromfrom = [FromFrom.GetName])"
		wtp_effect_remove_unrest = yes
		set_variable = {
			which = wtp_var_unrest
			value = 0
		}
	}
}

planet_event = {
	id = wtp.103
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		log = "WTP::WTP.103(this = [This.GetName], from = [From.GetName], fromfrom = [FromFrom.GetName])"
		wtp_effect_remove_unrest = yes
		set_variable = {
			which = wtp_var_unrest
			value = @unrest_threshold_low
		}
	}
}

planet_event = {
	id = wtp.104
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		log = "WTP::WTP.104(this = [This.GetName], from = [From.GetName], fromfrom = [FromFrom.GetName])"
		wtp_effect_remove_unrest = yes
		set_variable = {
			which = wtp_var_unrest
			value = @unrest_threshold_low
		}
	}
}

country_event = {
	id = wtp.106
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_country_type = default
		is_regular_empire = yes
	}
	immediate = {
		log = "WTP::WTP.106(this = [This.GetName], from = [From.GetName], fromfrom = [FromFrom.GetName])"
		every_owned_planet = {
			limit = {
				NOT = {
					sector = {
						is_same_value = PREVPREV.capital_scope.sector
					}
				}
				NOT = {
					wtp_trigger_has_unrest = yes
				}
			}
			random_list = {
				# nothing happens
				9999 = {
				}
				# generate unrest
				1 = {
					planet_event = {
						id = wtp.6
						days = 2
						random = 25
					}
				}
			}
		}
	}
}

# monthly unrest update
planet_event = {
	id = wtp.1
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NOR = {
			owner = {
				has_modifier = wtp_mod_revolutionary_war
				has_modifier = wtp_mod_recent_revolution
			}
		}
	}
	immediate = {
		log = "WTP::WTP.1(this = [This.GetName], from = [From.GetName], fromfrom = [FromFrom.GetName])"
		# calculate unclamped ethos
		wtp_effect_calculate_planet_ethos = yes
		# change unrest by clamped ethos
		if = {
			limit = {
				check_variable = {
					which = wtp_var_ethos
					value < -1
				}
			}
			change_variable = {
				which = wtp_var_unrest
				value = -1
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = wtp_var_ethos
					value > 1
				}
			}
			change_variable = {
				which = wtp_var_unrest
				value = 1
			}
		}
		else = {
			change_variable = {
				which = wtp_var_unrest
				value = wtp_var_ethos
			}
		}
		if = {
			limit = {
				check_variable = {
					which = wtp_var_unrest
					value < 0
				}
			}
			set_variable = {
				which = wtp_var_unrest
				value = 0
			}
		}
		if = {
			limit = {
				check_variable = {
					which = wtp_var_unrest
					value >= @unrest_threshold_high
				}
				NOT = {
					wtp_trigger_has_unrest = yes
				}
			}
			planet_event = {
				id = wtp.2
				days = 2
				random = 25
			}
		}
		if = {
			limit = {
				check_variable = {
					which = wtp_var_unrest
					value <= @unrest_threshold_low
				}
				wtp_trigger_has_unrest = yes
			}
			planet_event = {
				id = wtp.3
				days = 2
				random = 25
			}
		}
		if = {
			limit = {
				check_variable = {
					which = wtp_var_unrest
					value >= @rebellion_threshold
				}
				wtp_trigger_has_unrest = yes
			}
			planet_event = {
				id = wtp.4
				days = 2
				random = 25
			}
		}
	}
}

# start unrest
planet_event = {
	id = wtp.2
	is_triggered_only = yes
	title = wtp.2.name
	picture = GFX_evt_smugglers_in_bar
	show_sound = event_public_unrest
	immediate = {
		log = "WTP::WTP.2(this = [This.GetName], from = [From.GetName], fromfrom = [FromFrom.GetName])"
		wtp_effect_start_unrest = yes
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_spiritualist
		}
		text = wtp.2.1.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_materialist
		}
		text = wtp.2.2.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_militarist
		}
		text = wtp.2.3.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_pacifist
		}
		text = wtp.2.4.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_xenophobe
		}
		text = wtp.2.5.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_xenophile
		}
		text = wtp.2.6.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_egalitarian
		}
		text = wtp.2.7.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_authoritarian
		}
		text = wtp.2.8.desc
	}
	option = {
		name = wtp.2.ok
		ai_chance = {
			factor = 100
		}
	}
	option = {
		name = wtp.2.propaganda
		ai_chance = {
			factor = 0
		}
		add_modifier = {
			modifier = wtp_mod_propaganda
			days = -1
		}
	}
	option = {
		name = wtp.2.crackdown
		ai_chance = {
			factor = 0
		}
		add_modifier = {
			modifier = wtp_mod_crackdown
			days = -1
		}
	}
	option = {
		name = wtp.2.release
		ai_chance = {
			factor = 0
		}
		custom_tooltip = wtp.2.release.tooltip
		hidden_effect = {
			wtp_effect_grant_autonomy = yes
		}
	}
}

# cancel unrest event
planet_event = {
	id = wtp.3
	is_triggered_only = yes
	title = wtp.3.name
	desc = wtp.3.desc
	picture = GFX_evt_announcement
	show_sound = event_announcement
	immediate = {
		log = "WTP::WTP.3(this = [This.GetName], from = [From.GetName], fromfrom = [FromFrom.GetName])"
		wtp_effect_remove_unrest = yes
	}
	option = {
		name = wtp.3.ok
		hidden_effect = {
			remove_modifier = wtp_mod_propaganda
			remove_modifier = wtp_mod_crackdown
		}
	}
}

# issue ultimatum
planet_event = {
	id = wtp.4
	is_triggered_only = yes
	title = wtp.4.name
	picture = GFX_evt_burning_settlement
	show_sound = event_planetary_riot
	immediate = {
		log = "WTP::WTP.4(this = [This.GetName], from = [From.GetName], fromfrom = [FromFrom.GetName])"
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_spiritualist
		}
		text = wtp.4.1.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_materialist
		}
		text = wtp.4.2.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_militarist
		}
		text = wtp.4.3.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_pacifist
		}
		text = wtp.4.4.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_xenophobe
		}
		text = wtp.4.5.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_xenophile
		}
		text = wtp.4.6.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_egalitarian
		}
		text = wtp.4.7.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_authoritarian
		}
		text = wtp.4.8.desc
	}
	option = {
		name = wtp.4.accept
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				owner = {
					OR = {
						has_ethic = ethic_fanatic_authoritarian
						has_ethic = ethic_fanatic_militarist
					}
				}
			}
			modifier = {
				factor = 2
				owner = {
					OR = {
						has_ethic = ethic_pacifist
					}
				}
			}
			modifier = {
				factor = 2
				owner = {
					used_naval_capacity_percent < 0.5
				}
			}
			modifier = {
				factor = 5
				owner = {
					used_naval_capacity_percent < 0.25
				}
			}
		}
		custom_tooltip = wtp.4.accept.tooltip
		hidden_effect = {
			wtp_effect_grant_autonomy = yes
		}
	}
	option = {
		name = wtp.4.refuse
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				owner = {
					OR = {
						has_ethic = ethic_fanatic_pacifist
					}
				}
			}
			modifier = {
				factor = 2
				owner = {
					OR = {
						has_ethic = ethic_authoritarian
						has_ethic = ethic_militarist
					}
				}
			}
			modifier = {
				factor = 5
				owner = {
					used_naval_capacity_percent > 0.75
				}
			}
		}
		custom_tooltip = wtp.4.refuse.tooltip
		hidden_effect = {
			wtp_effect_start_war = yes
		}
	}
	option = {
		name = wtp.4.join
		ai_chance = {
			factor = 0
		}
		custom_tooltip = wtp.4.join.tooltip
		hidden_effect = {
			wtp_effect_start_war = yes
			event_target:wtp_rebel_alliance_leader = {
				set_player = event_target:wtp_mother_country
			}
		}
	}
}

# start sudden unrest
planet_event = {
	id = wtp.6
	is_triggered_only = yes
	title = wtp.6.name
	picture = GFX_evt_smugglers_in_bar
	show_sound = event_public_unrest
	immediate = {
		log = "WTP::WTP.6(this = [This.GetName], from = [From.GetName], fromfrom = [FromFrom.GetName])"
		wtp_effect_start_unrest = yes
		set_variable = {
			which = wtp_var_unrest
			value = @unrest_threshold_high
		}
		every_owned_pop = {
			wipe_pop_ethos = yes
			planet = {
				switch = {
					trigger = has_modifier
					wtp_mod_unrest_spiritualist = {
						prev = {
							pop_change_ethic = ethic_spiritualist
						}
					}
					wtp_mod_unrest_materialist = {
						prev = {
							pop_change_ethic = ethic_materialist
						}
					}
					wtp_mod_unrest_militarist = {
						prev = {
							pop_change_ethic = ethic_militarist
						}
					}
					wtp_mod_unrest_pacifist = {
						prev = {
							pop_change_ethic = ethic_pacifist
						}
					}
					wtp_mod_unrest_xenophobe = {
						prev = {
							pop_change_ethic = ethic_xenophobe
						}
					}
					wtp_mod_unrest_xenophile = {
						prev = {
							pop_change_ethic = ethic_xenophile
						}
					}
					wtp_mod_unrest_egalitarian = {
						prev = {
							pop_change_ethic = ethic_egalitarian
						}
					}
					wtp_mod_unrest_authoritarian = {
						prev = {
							pop_change_ethic = ethic_authoritarian
						}
					}
				}
			}
			force_faction_evaluation = yes
		}
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_spiritualist
		}
		text = wtp.6.1.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_materialist
		}
		text = wtp.6.2.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_militarist
		}
		text = wtp.6.3.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_pacifist
		}
		text = wtp.6.4.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_xenophobe
		}
		text = wtp.6.5.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_xenophile
		}
		text = wtp.6.6.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_egalitarian
		}
		text = wtp.6.7.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_authoritarian
		}
		text = wtp.6.8.desc
	}
	option = {
		name = wtp.6.ok
		ai_chance = {
			factor = 100
		}
	}
	option = {
		name = wtp.6.propaganda
		ai_chance = {
			factor = 0
		}
		add_modifier = {
			modifier = wtp_mod_propaganda
			days = -1
		}
	}
	option = {
		name = wtp.6.crackdown
		ai_chance = {
			factor = 0
		}
		add_modifier = {
			modifier = wtp_mod_crackdown
			days = -1
		}
	}
	option = {
		name = wtp.6.release
		ai_chance = {
			factor = 0
		}
		custom_tooltip = wtp.6.release.tooltip
		hidden_effect = {
			wtp_effect_grant_autonomy = yes
		}
	}
}
