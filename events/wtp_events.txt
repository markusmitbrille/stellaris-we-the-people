namespace = wtp
@unrest_threshold_low = 12
@unrest_threshold_medium = 36
@unrest_threshold_high = 60
@rebellion_threshold = 120
country_event = {
	id = wtp.100
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		is_country_type = default
		is_regular_empire = yes
	}
	immediate = {
		log = "WTP::WTP.100"
		every_owned_planet = {
			if = {
				limit = {
					sector = {
						is_same_value = PREVPREV.capital_scope.sector
					}
				}
				set_variable = {
					which = wtp_var_unrest
					value = 0
				}
			}
			else = {
				planet_event = {
					id = wtp.1
				}
			}
		}
	}
}

country_event = {
	id = wtp.101
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		NAND = {
			is_country_type = default
			is_regular_empire = yes
		}
	}
	immediate = {
		log = "WTP::WTP.101"
		every_owned_planet = {
			wtp_effect_remove_unrest = yes
			set_variable = {
				which = wtp_var_unrest
				value = 0
			}
		}
	}
}

planet_event = {
	id = wtp.102
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		log = "WTP::WTP.102"
		wtp_effect_remove_unrest = yes
		set_variable = {
			which = wtp_var_unrest
			value = 0
		}
	}
}

planet_event = {
	id = wtp.103
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		log = "WTP::WTP.103"
		wtp_effect_remove_unrest = yes
		set_variable = {
			which = wtp_var_unrest
			value = @unrest_threshold_low
		}
	}
}

planet_event = {
	id = wtp.104
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		log = "WTP::WTP.104"
		wtp_effect_remove_unrest = yes
		set_variable = {
			which = wtp_var_unrest
			value = @unrest_threshold_low
		}
	}
}

# monthly unrest update
planet_event = {
	id = wtp.1
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		log = "WTP::WTP.1(this = [This.GetName], from = [From.GetName], fromfrom = [FromFrom.GetName])"
		wtp_effect_calculate_planet_ethos = yes
		change_variable = {
			which = wtp_var_unrest
			value = wtp_var_ethos
		}
		if = {
			limit = {
				check_variable = {
					which = wtp_var_unrest
					value < 0
				}
			}
			set_variable = {
				which = wtp_var_unrest
				value = 0
			}
		}
		if = {
			limit = {
				check_variable = {
					which = wtp_var_unrest
					value >= @unrest_threshold_high
				}
				NOT = {
					wtp_trigger_has_unrest = yes
				}
				NOT = {
					owner = {
						has_modifier = wtp_mod_recent_revolution
					}
				}
			}
			planet_event = {
				id = wtp.2
			}
		}
		if = {
			limit = {
				check_variable = {
					which = wtp_var_unrest
					value <= @unrest_threshold_low
				}
				wtp_trigger_has_unrest = yes
			}
			planet_event = {
				id = wtp.3
			}
		}
		if = {
			limit = {
				check_variable = {
					which = wtp_var_unrest
					value >= @rebellion_threshold
				}
				wtp_trigger_has_unrest = yes
				NOT = {
					owner = {
						has_modifier = wtp_mod_recent_revolution
					}
				}
			}
			planet_event = {
				id = wtp.4
			}
		}
	}
}

# start unrest
planet_event = {
	id = wtp.2
	is_triggered_only = yes
	title = wtp.2.name
	picture = GFX_evt_smugglers_in_bar
	show_sound = event_public_unrest
	immediate = {
		log = "WTP::WTP.2(this = [This.GetName], from = [From.GetName], fromfrom = [FromFrom.GetName])"
		wtp_effect_start_unrest = yes
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_spiritualist
		}
		text = wtp.2.1.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_materialist
		}
		text = wtp.2.2.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_militarist
		}
		text = wtp.2.3.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_pacifist
		}
		text = wtp.2.4.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_xenophobe
		}
		text = wtp.2.5.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_xenophile
		}
		text = wtp.2.6.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_egalitarian
		}
		text = wtp.2.7.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_authoritarian
		}
		text = wtp.2.8.desc
	}
	option = {
		name = wtp.2.ok
		ai_chance = {
			factor = 100
		}
	}
	option = {
		name = wtp.2.propaganda
		ai_chance = {
			factor = 0
		}
		add_modifier = {
			modifier = wtp_mod_propaganda
			days = -1
		}
	}
	option = {
		name = wtp.2.crackdown
		ai_chance = {
			factor = 0
		}
		add_modifier = {
			modifier = wtp_mod_crackdown
			days = -1
		}
	}
	option = {
		name = wtp.2.release
		ai_chance = {
			factor = 0
		}
		custom_tooltip = wtp.2.release.tooltip
		hidden_effect = {
			wtp_effect_grant_autonomy = yes
		}
	}
}

# cancel unrest event
planet_event = {
	id = wtp.3
	is_triggered_only = yes
	title = wtp.3.name
	desc = wtp.3.desc
	picture = GFX_evt_announcement
	show_sound = event_announcement
	immediate = {
		log = "WTP::WTP.3(this = [This.GetName], from = [From.GetName], fromfrom = [FromFrom.GetName])"
		wtp_effect_remove_unrest = yes
	}
	option = {
		name = wtp.3.ok
		hidden_effect = {
			remove_modifier = wtp_mod_propaganda
			remove_modifier = wtp_mod_crackdown
		}
	}
}

# issue ultimatum
planet_event = {
	id = wtp.4
	is_triggered_only = yes
	title = wtp.4.name
	picture = GFX_evt_burning_settlement
	show_sound = event_planetary_riot
	immediate = {
		log = "WTP::WTP.4(this = [This.GetName], from = [From.GetName], fromfrom = [FromFrom.GetName])"
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_spiritualist
		}
		text = wtp.4.1.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_materialist
		}
		text = wtp.4.2.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_militarist
		}
		text = wtp.4.3.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_pacifist
		}
		text = wtp.4.4.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_xenophobe
		}
		text = wtp.4.5.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_xenophile
		}
		text = wtp.4.6.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_egalitarian
		}
		text = wtp.4.7.desc
	}
	desc = {
		trigger = {
			has_modifier = wtp_mod_unrest_authoritarian
		}
		text = wtp.4.8.desc
	}
	option = {
		name = wtp.4.accept
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				owner = {
					OR = {
						has_ethic = ethic_fanatic_authoritarian
						has_ethic = ethic_fanatic_militarist
					}
				}
			}
			modifier = {
				factor = 2
				owner = {
					OR = {
						has_ethic = ethic_pacifist
					}
				}
			}
			modifier = {
				factor = 2
				owner = {
					used_naval_capacity_percent < 0.5
				}
			}
			modifier = {
				factor = 5
				owner = {
					used_naval_capacity_percent < 0.25
				}
			}
		}
		custom_tooltip = wtp.4.accept.tooltip
		hidden_effect = {
			wtp_effect_grant_autonomy = yes
		}
	}
	option = {
		name = wtp.4.refuse
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				owner = {
					OR = {
						has_ethic = ethic_fanatic_pacifist
					}
				}
			}
			modifier = {
				factor = 2
				owner = {
					OR = {
						has_ethic = ethic_authoritarian
						has_ethic = ethic_militarist
					}
				}
			}
			modifier = {
				factor = 5
				owner = {
					used_naval_capacity_percent > 0.75
				}
			}
		}
		custom_tooltip = wtp.4.refuse.tooltip
		hidden_effect = {
			wtp_effect_start_war = yes
		}
	}
	option = {
		name = wtp.4.join
		ai_chance = {
			factor = 0
		}
		hidden_effect = {
			wtp_effect_start_war = yes
			event_target:wtp_rebel_alliance_leader = {
				set_player = event_target:wtp_mother_country
			}
		}
	}
}

# mother country peace event
country_event = {
	id = wtp.5
	is_triggered_only = yes
	title = wtp.5.name
	picture = GFX_evt_news_room
	show_sound = event_announcement
	immediate = {
		log = "WTP::WTP.5(this = [This.GetName], from = [From.GetName], fromfrom = [FromFrom.GetName])"
	}
	option = {
		name = wtp.5.ok
		remove_modifier = wtp_mod_revolutionary_war
		add_modifier = {
			modifier = wtp_mod_recent_revolution
			years = 10
		}
	}
}

# rebel country peace event
country_event = {
	id = wtp.6
	is_triggered_only = yes
	title = wtp.6.name
	picture = GFX_evt_news_room
	show_sound = event_announcement
	immediate = {
		log = "WTP::WTP.6(this = [This.GetName], from = [From.GetName], fromfrom = [FromFrom.GetName])"
	}
	option = {
		name = wtp.6.ok
		remove_modifier = wtp_mod_revolutionary_war
		add_modifier = {
			modifier = wtp_mod_recent_revolution
			years = 10
		}
	}
}
